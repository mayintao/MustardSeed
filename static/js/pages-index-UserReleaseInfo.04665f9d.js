(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-index-UserReleaseInfo"],{"0373":function(e,t,a){var i=a("c86c");t=i(!1),t.push([e.i,".container[data-v-165a5a81]{padding:%?24?%;background:#f5f7fa;min-height:100vh}.form-card[data-v-165a5a81]{background:#fff;border-radius:%?16?%;padding:%?24?%;box-shadow:0 %?8?% %?24?% rgba(0,0,0,.04)}.form-item[data-v-165a5a81]{margin-bottom:%?24?%}.label[data-v-165a5a81]{display:block;font-size:%?26?%;color:#555;margin-bottom:%?10?%}.input[data-v-165a5a81]{background:#f7f8fa;border-radius:%?10?%;padding:%?20?%;font-size:%?28?%}.textarea[data-v-165a5a81]{background:#f7f8fa;border-radius:%?10?%;padding:%?20?%;font-size:%?28?%;min-height:%?160?%}.picker[data-v-165a5a81]{color:#999}.type-group[data-v-165a5a81]{display:flex;gap:%?20?%}.type-btn[data-v-165a5a81]{padding:%?14?% %?28?%;border-radius:%?30?%;border:1px solid #ddd;font-size:%?26?%;color:#666}.type-btn.active[data-v-165a5a81]{background:#2979ff;color:#fff;border-color:#2979ff}.submit-btn[data-v-165a5a81]{margin-top:%?40?%;background:linear-gradient(135deg,#2979ff,#4fc3f7);color:#fff;text-align:center;padding:%?26?%;border-radius:%?40?%;font-size:%?30?%;font-weight:700}\n\n/* 图片样式 */.images-group[data-v-165a5a81]{display:flex;flex-wrap:wrap;gap:%?16?%}.image-wrapper[data-v-165a5a81]{position:relative;width:%?160?%;height:%?160?%}.image-thumb[data-v-165a5a81]{width:100%;height:100%;border-radius:%?10?%}.delete-btn[data-v-165a5a81]{position:absolute;top:%?-10?%;right:%?-10?%;width:%?32?%;height:%?32?%;background:red;color:#fff;text-align:center;line-height:%?32?%;border-radius:50%;font-size:%?24?%}.add-image[data-v-165a5a81]{width:%?160?%;height:%?160?%;background:#f7f8fa;display:flex;justify-content:center;align-items:center;font-size:%?48?%;color:#999;border-radius:%?10?%}",""]),e.exports=t},"07c2":function(e,t,a){"use strict";a.r(t);var i=a("47c5"),n=a.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(r);t["default"]=n.a},"14f8":function(e,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){}));var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{staticClass:"container"},[a("v-uni-view",{staticClass:"form-card"},[a("v-uni-view",{staticClass:"form-item"},[a("v-uni-text",{staticClass:"label"},[e._v("标题")]),a("v-uni-input",{staticClass:"input",attrs:{placeholder:"请输入标题"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),a("v-uni-view",{staticClass:"form-item"},[a("v-uni-text",{staticClass:"label"},[e._v("交易类型")]),a("v-uni-view",{staticClass:"type-group"},e._l(e.tradeTypes,(function(t){return a("v-uni-view",{key:t.value,class:["type-btn",e.form.tradeType===t.value?"active":""],on:{click:function(a){arguments[0]=a=e.$handleEvent(a),e.form.tradeType=t.value}}},[e._v(" "+e._s(t.label)+" ")])})),1)],1),2!==e.form.tradeType?a("v-uni-view",{staticClass:"form-item"},[a("v-uni-text",{staticClass:"label"},[e._v("价格（RM）")]),a("v-uni-input",{staticClass:"input",attrs:{type:"number",placeholder:"请输入价格"},model:{value:e.form.price,callback:function(t){e.$set(e.form,"price",t)},expression:"form.price"}})],1):e._e(),4===e.form.tradeType?a("v-uni-view",{staticClass:"form-item"},[a("v-uni-text",{staticClass:"label"},[e._v("到期时间")]),a("v-uni-picker",{attrs:{mode:"date"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.onDateChange.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"input picker"},[e._v(" "+e._s(e.form.expire_date||"请选择到期时间")+" ")])],1)],1):e._e(),a("v-uni-view",{staticClass:"form-item"},[a("v-uni-text",{staticClass:"label"},[e._v("详细内容")]),a("v-uni-textarea",{staticClass:"textarea",attrs:{placeholder:"请详细描述"},model:{value:e.form.detail,callback:function(t){e.$set(e.form,"detail",t)},expression:"form.detail"}})],1),4===e.form.tradeType?a("v-uni-view",{staticClass:"form-item"},[a("v-uni-text",{staticClass:"label"},[e._v("房屋地址")]),a("v-uni-input",{staticClass:"input",attrs:{placeholder:"请输入房屋地址"},model:{value:e.form.house_address,callback:function(t){e.$set(e.form,"house_address",t)},expression:"form.house_address"}})],1):e._e(),a("v-uni-view",{staticClass:"form-item"},[a("v-uni-text",{staticClass:"label"},[e._v("联系方式")]),a("v-uni-input",{staticClass:"input",attrs:{placeholder:"微信 / 电话 / WhatsApp"},model:{value:e.form.contact,callback:function(t){e.$set(e.form,"contact",t)},expression:"form.contact"}})],1),a("v-uni-view",{staticClass:"form-item"},[a("v-uni-text",{staticClass:"label"},[e._v("交易方式及地址")]),a("v-uni-input",{staticClass:"input",attrs:{placeholder:"请输入交易方式及地址（Cash & Lotus）"},model:{value:e.form.address,callback:function(t){e.$set(e.form,"address",t)},expression:"form.address"}})],1),a("v-uni-view",{staticClass:"form-item"},[a("v-uni-text",{staticClass:"label"},[e._v("图片（最多9张）")]),a("v-uni-view",{staticClass:"images-group"},[e._l(e.form.images,(function(t,i){return a("v-uni-view",{key:i,staticClass:"image-wrapper"},[a("v-uni-image",{staticClass:"image-thumb",attrs:{src:t,mode:"aspectFill"}}),a("v-uni-view",{staticClass:"delete-btn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.removeImage(i)}}},[e._v("×")])],1)})),e.form.images.length<9?a("v-uni-view",{staticClass:"add-image",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.chooseImages.apply(void 0,arguments)}}},[e._v("+")]):e._e()],2)],1)],1),a("v-uni-view",{staticClass:"submit-btn",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.submit.apply(void 0,arguments)}}},[e._v(" 发布信息 ")])],1)},n=[]},"30f7":function(e,t,a){"use strict";a("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},a("7a76"),a("c9b5")},3150:function(e,t,a){"use strict";a.r(t);var i=a("14f8"),n=a("07c2");for(var r in n)["default"].indexOf(r)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(r);a("d961");var s=a("828b"),o=Object(s["a"])(n["default"],i["b"],i["c"],!1,null,"165a5a81",null,!1,i["a"],void 0);t["default"]=o.exports},4733:function(e,t,a){"use strict";a("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if(Array.isArray(e))return(0,i.default)(e)};var i=function(e){return e&&e.__esModule?e:{default:e}}(a("8d0b"))},"47c5":function(e,t,a){"use strict";a("6a54");var i=a("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=i(a("2634")),r=i(a("2fdc")),s=i(a("b7c7"));a("64aa"),a("aa9c"),a("dd2b"),a("d4b5"),a("bf0f"),a("fd3c"),a("18f7"),a("de6c");var o={data:function(){return{user_name:"",sts:null,tradeTypes:[{label:"免费送",value:2},{label:"二手交易",value:3},{label:"房屋转租",value:4}],form:{title:"",tradeType:2,price:"",expire_date:"",detail:"",contact:"",address:"",house_address:"",images:[]}}},onLoad:function(e){var t=uni.getStorageSync("user_info");t&&(this.user_name=t.user_name,console.log(this.user_name)),e&&(this.form.tradeType=Number(e.type),console.log(this.form.tradeType))},methods:{onDateChange:function(e){this.form.expire_date=e.detail.value},chooseImages:function(){var e=this,t=9-this.form.images.length;uni.chooseImage({count:t,success:function(t){var a;(a=e.form.images).push.apply(a,(0,s.default)(t.tempFilePaths))}})},removeImage:function(e){this.form.images.splice(e,1)},submit:function(){var e=this;return(0,r.default)((0,n.default)().mark((function t(){var a,i;return(0,n.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.form.title&&e.form.detail){t.next=3;break}return uni.showToast({title:"请填写标题和内容",icon:"none"}),t.abrupt("return");case 3:if(e.form.contact&&e.form.address){t.next=6;break}return uni.showToast({title:"请填写联系方式和交易地址",icon:"none"}),t.abrupt("return");case 6:return uni.showLoading({title:"发布中..."}),t.prev=7,t.next=10,e.uploadImages();case 10:a=t.sent,console.log(a),i=JSON.stringify(a),uni.request({url:"https://nbmjserver.onrender.com/ms/api/insertMSUserReleaseInfo",method:"POST",header:{"Content-Type":"application/json"},data:{user_name:e.user_name,type:e.form.tradeType,title:e.form.title,detail:e.form.detail,house_address:e.form.house_address,image_urls:i,contact:e.form.contact,address:e.form.address,price:e.form.price,expire_date:e.form.expire_date,key:"servermustardseed1768725120528"},success:function(e){uni.hideLoading(),console.log(e),console.log(e.data.desc),200===e.data.code?(uni.showToast({title:"发布成功"}),uni.navigateBack()):uni.showToast({title:e.data.desc,icon:"fail"})},fail:function(e){uni.hideLoading(),console.log(e),uni.showModal({title:"提示",content:e.errMsg,showCancel:!1})}}),t.next=21;break;case 16:t.prev=16,t.t0=t["catch"](7),uni.hideLoading(),console.error(t.t0),uni.showModal({content:"发布失败，请稍后再试",showCancel:!1});case 21:case"end":return t.stop()}}),t,null,[[7,16]])})))()},uploadImages:function(){var e=this.form.images||[];if(0===e.length)return Promise.resolve([]);var t=e.map((function(e){return new Promise((function(t,a){uni.uploadFile({url:"https://nbmjserver.onrender.com/api/uploadfile",filePath:e,name:"file",formData:{Bucket:"mbts-apply"},success:function(e){try{var i=JSON.parse(e.data);t(i.url)}catch(n){a(n)}},fail:a})}))}));return Promise.all(t)}}};t.default=o},5400:function(e,t,a){var i=a("0373");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var n=a("967d").default;n("4581a7fe",i,!0,{sourceMap:!1,shadowMode:!1})},b7c7:function(e,t,a){"use strict";a("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return(0,i.default)(e)||(0,n.default)(e)||(0,r.default)(e)||(0,s.default)()};var i=o(a("4733")),n=o(a("d14d")),r=o(a("5d6b")),s=o(a("30f7"));function o(e){return e&&e.__esModule?e:{default:e}}},d14d:function(e,t,a){"use strict";a("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},a("01a2"),a("e39c"),a("bf0f"),a("844d"),a("18f7"),a("de6c"),a("08eb")},d961:function(e,t,a){"use strict";var i=a("5400"),n=a.n(i);n.a}}]);